{% set name = "AmberTools" %}
# Versioning scheme uses AmberTools major release as MAJOR version number, patch level as MINOR version number
# Update the MINOR version number as new patch releases come out
{% set version = "20.0" %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  url: http://ambermd.org/downloads/AmberTools20.RC2.tar.bz2
  sha256: 075b844fd33b276d1aaee0b0ac3a65831d6a4976b587a7073aaee5754fdaac70
  patches:
    # From AT19.11
    # Fix weird bug described here:
    #   https://github.com/conda-forge/ambertools-feedstock/pull/11#issuecomment-570618741
    - patches/delete_xdrfile_version.patch  # [osx]
    # From AT20RC2
    - patches/disable_boost_checks.patch
    - patches/env_shebang.patch
    - patches/mm_pbsa_statistics_lib.patch
    # - patches/fix_cpinutil_pKa_comparison_bug.patch
    # ## Tests
    # - patches/fix_run_nef_tests.patch
    # - patches/fix_sander_1ahoa_pme_test.patch
    # ## /Tests

build:
  number: 0
  skip: True  # [win or py2k]

requirements:
  build:
    - {{ compiler('fortran') }}
    - {{ compiler('c') }}
    - {{ compiler('cxx') }}
    - ld64 409.12 h3c32e8a_4   # [osx]
    - bc
    - flex
    - patch
    - tcsh
    - bison
    - make
    - cmake
    - perl
    - llvm-openmp  # [osx]
    - libgomp      # [linux and not aarch64]
  host:
    - python
    - setuptools
    - cython
    - numpy
    - scipy
    - matplotlib-base
    - bzip2
    - zlib
    - boost-cpp
    - libnetcdf
    - netcdf-fortran
    - pthread-stubs
    - fftw
    - arpack  # [not ppc64le]
    - libblas
    - liblapack
    - xorg-libxt  # [linux]
    - xorg-libxext   # [linux]
    - xorg-libx11   # [linux]
    - readline
    - llvm-openmp  # [osx]
    - libgomp      # [linux and not aarch64]
  run:
    - python
    - perl
    - cython
    - numpy
    - scipy
    - matplotlib-base
    - boost-cpp
    - libnetcdf
    - netcdf-fortran
    - fftw
    - libblas
    - liblapack
    - xorg-libxt  # [linux]
    - xorg-libxext  # [linux]
    - xorg-libx11   # [linux]
    - readline
    - llvm-openmp  # [osx]
    - libgomp      # [linux and not aarch64]
  run_constrained:
    - ambermini ==9999999999

test:
  requires:
    - {{ compiler('fortran') }}
    - {{ compiler('c') }}
    - {{ compiler('cxx') }}
    - tcsh  # [linux64]
    - util-linux  # [linux64]
    # Try to force a library incompatibility error in osx (see #22)
    - lxml  # [osx]
    - rdkit  # [osx]
  commands:
    - add_pdb -h
    - add_xray -h
    - am1bcc -h
    - amb2chm_par.py -h
    - amb2chm_psf_crd.py -h
    - amb2gro_top_gro.py -h
    - ambmask -h
    - ambpdb -h
    - ante-MMPBSA.py -h
    - antechamber -h
    - atomtype -h
    - bondtype -h
    - car_to_files.py -h
    - CartHess2FC.py -h
    - ceinutil.py -h
    - cpeinutil.py -h
    - cpinutil.py -h
    - cpptraj -h
    - draw_membrane2
    - espgen -h
    - espgen.py -h
    - FEW.pl -h
    - ffgbsa -h
    - finddgref.py -h
    - fitpkaeo.py -h
    - fixremdcouts.py -h
    - genremdinputs.py -h
    - IPMach.py -h
    - makeANG_RST -help
    - MCPB.py -h
    - mdgx -h
    - mdnab -h
    - mdout2pymbar.pl -h
    - metalpdb2mol2.py -h
    - minab -h
    - MMPBSA.py -h
    - mol2rtf.py -h
    - nfe-umbrella-slice -h
    - packmol-memgen -h
    - parmed -h
    - pdb4amber -h
    - PdbSearcher.py -h
    - prepgen -h
    - ProScrs.py -h
    - pymdpbsa -h
    - pytleap -h
    - reduce -V
    - resp -h
    - respgen -h
    - saxs_md -h
    - softcore_setup.py -h
    - sqm -h
    - sviol -h
    - sviol2 -h
    - teLeap -h
    - tleap -h
    - UnitCell
    # These two commands need csh, but CF only has tcsh
    - ln -s ${PREFIX}/bin/tcsh ${PREFIX}/bin/csh  # [linux64]
    - sgldinfo.sh  # [linux64]
    - sgldwt.sh  # [linux64]
  imports:
    - parmed
    - pdb4amber
    - pymsmt
    - pytraj
    - sander
    # Try to force a library incompatibility error in osx (see #22)
    - rdkit  # [osx]
    - rdkit.Chem.AllChem  # [osx]

about:
  home: http://ambermd.org/AmberTools.php
  license: Multiple
  license_file: AmberTools/LICENSE
  summary: 'AmberTools is a set of programs for biomolecular simulation and analysis'
  description: |
    AmberTools is a set of programs for biomolecular simulation and analysis.
    They are designed to work well with each other, and with the "regular" Amber
    suite of programs. You can perform many simulation tasks with AmberTools,
    and you can do more extensive simulations with the combination of AmberTools
    and Amber itself.

extra:
  recipe-maintainers:
    - simonbray
    - jaimergp
